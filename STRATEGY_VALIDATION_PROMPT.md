# 트레이딩 전략 검증 프롬프트 (엄격 버전)

## 사용 방법
아래 프롬프트를 복사하여 AI(Claude 등)에게 전달하세요. `[전략 정보]`를 실제 전략으로 교체합니다.
가능하면 **전략 코드/데이터 경로/실행 스크립트**까지 함께 제공합니다.

---

## 검증 프롬프트

```
당신은 퀀트 전략 검증 전문가입니다. 아래 트레이딩 전략을 **엄격하게** 검증하고, PASS/FAIL을 판정하세요.
모든 결과는 **재현 가능한 설정(비용/슬리피지/시그널 지연/체결 가격)** 하에 산출해야 합니다.

## 0. 검증 대상 전략 (필수 입력)

[전략 정보를 여기에 입력]
- 전략명:
- 대상 자산/시장: (예: KOSPI200 선물 / KRX ETF / Upbit Spot / Binance Futures 등)
- 타임프레임: (일봉/분봉 등)
- 매수 조건:
- 매도 조건:
- 포지션 규칙: (롱/숏/중립, 레버리지/마진 사용 여부, 최대 보유 비중, 동시 보유 종목 수)
- 리밸런싱: (빈도, 리밸런싱 방식)
- 데이터 경로:
- 백테스트 코드 경로 (있는 경우):
- 벤치마크: (기본 B&H + 필요시 무위험/동종 지수 등)

### 0-1. 공통 정의(반드시 준수)
- 실행: **당일 종가로 시그널 생성 → 익일 시가 체결(1일 지연)** (변경 시 명시)
- 알파(α): 동일 실행/비용/포지션 비중 규칙의 **전략 누적수익률 - 벤치마크(B&H) 누적수익률**
- 비용 모델: 수수료(편도) + 슬리피지(편도) + 스프레드(옵션)
- 결과는 반드시 **비용 반영 전/후** 모두 제시

---

## 1. 필수 검증 항목 (5가지 모두 통과해야 함)

### 1) IS/OOS 일관성 검증
- IS: 2015-01-01 ~ 2024-01-01
- OOS: 2024-01-01 ~ 현재
- 통과 기준:
  - IS 알파(비용 후) > 0 AND OOS 알파(비용 후) > 0
  - (보조) OOS 거래 수가 너무 적으면 "판정 보류(FAIL)"로 처리 (권장: OOS 거래 >= 30)

### 2) Walk-Forward 검증 (가장 중요)
- 방법: 2년 IS -> 1년 OOS 롤링 (2017년부터 가능한 구간까지)
- 각 연도별 IS/OOS 알파(비용 후) 계산
- 통과 기준:
  - OOS 알파 평균(비용 후) > 0
  - OOS 알파 양수 비율 > 50%
  - (보조) 최악 연도 OOS 알파가 -X% 이하로 붕괴하면 FAIL (권장 X=10~15, 시장에 맞게 조정)

### 3) 파라미터 강건성 검증
- 핵심 파라미터를 +/-20% 변경하여 OOS 재검증
- 통과 기준:
  - 파라미터 조합 중 OOS 알파(비용 후) > 0 인 경우가 과반수
  - (보조) "최적 파라미터 1개만 특출"이면 과최적화 의심으로 FAIL 가능

### 4) 실거래 가능성 검증
- 통과 기준:
  - 비용 반영 후 OOS CAGR > 4.5%
  - (보조) OOS Turnover(연환산)와 거래빈도 함께 보고, 비용 민감도(0.5x/1.0x/1.5x)에서 붕괴하지 않아야 함

### 5) 리스크 검증
- 통과 기준:
  - OOS MDD > -25%
  - (보조) Max Drawdown Duration(회복까지 최대 기간) 과도하면 FAIL 가능
  - (보조) 최악 월/주 수익률(또는 1% VaR 수준) 제시

---

## 2. 백테스트 설정 (기본값, 시장별로 수정 가능)

```python
initial_capital = 10_000_000  # 1천만원
position_size = 0.95          # 자본의 95% 투자 (현금 5% 유지)

# 비용(기본값) - 시장에 맞게 조정 가능하나, 변경 시 반드시 명시
fee_rate = 0.0015   # 편도 0.15%
slippage = 0.0010   # 편도 0.10%

# 체결 가격 (기본: 익일 시가, 슬리피지 반영)
entry_price = next_day_open * (1 + slippage)
exit_price  = next_day_open * (1 - slippage)

# 시그널 지연 (필수)
signals = signals.shift(1)  # 당일 종가 시그널 -> 익일 시가 실행
```

### 2-1. 비용 민감도(필수 보조 체크)
- 비용 0.5x / 1.0x / 1.5x에서 OOS 성과(알파, CAGR, MDD) 재산출
- "비용 1.5x에서 전략 붕괴"면 실거래성 낮음으로 FAIL 가능

### 2-2. 시장별 비용 가이드라인
| 시장 | 수수료(편도) | 슬리피지(편도) | 비고 |
|------|-------------|---------------|------|
| KRX 주식/ETF | 0.015% | 0.05~0.10% | HTS/MTS 기준 |
| KRX 선물 | 0.003% | 0.01~0.02% | 유동성 좋음 |
| 업비트/빗썸 | 0.05% | 0.10~0.30% | 변동성 높음 |
| 바이낸스 선물 | 0.02~0.04% | 0.02~0.05% | 메이커/테이커 |

---

## 3. 검증 결과 보고 형식 (반드시 이 템플릿으로)

```
=== 전략 검증 결과 ===
전략명: [전략명]
검증일: [날짜]
시장/자산: [자산]
타임프레임: [일봉/분봉]
비용 가정: fee=[x]%, slippage=[y]%, 실행=익일시가, 시그널=1일지연

0) 데이터/표본 점검
- IS 기간: [시작] ~ [종료] ([N]일)
- OOS 기간: [시작] ~ [종료] ([N]일)
- OOS 거래 수: [N]회
- 결측/거래정지 처리: [방법]
- 결과: [OK / FAIL(표본 부족 등)]

1) IS/OOS 일관성
- IS 알파(비용 전/후): [X.X]% / [X.X]%
- OOS 알파(비용 전/후): [X.X]% / [X.X]%
- 결과: [PASS/FAIL]

2) Walk-Forward
- OOS 알파 평균(비용 후): [X.X]%
- OOS 양수 비율: [XX]%
- 연도별 상세:
  2017: IS [X.X]% OOS [X.X]% [O/X]
  2018: IS [X.X]% OOS [X.X]% [O/X]
  ...
- 최악 OOS 연도: [YYYY], OOS 알파 [X.X]%
- 결과: [PASS/FAIL]

3) 파라미터 강건성
- 테스트 조합 수: [N]개
- OOS 알파 양수 비율(비용 후): [XX]%
- "최적 1개만 특출" 여부: [예/아니오]
- 파라미터별 OOS 알파 분포: [min] ~ [max], 중앙값 [X.X]%
- 결과: [PASS/FAIL]

4) 실거래 가능성
- OOS CAGR(비용 전/후): [X.X]% / [X.X]%
- Turnover(연환산): [X.X]회
- 비용 민감도(0.5x/1.0x/1.5x) OOS CAGR: [X.X]% / [X.X]% / [X.X]%
- 결과: [PASS/FAIL]

5) 리스크
- OOS MDD: [X.X]%
- B&H MDD: [X.X]%
- Max DD Duration: [N]일 (또는 [N]개월)
- 최악 월 수익률: [X.X]%
- 최악 주 수익률: [X.X]%
- 결과: [PASS/FAIL]

=== 최종 판정 ===
통과: [N]/5
판정: [PASS - 실거래 고려 가능 / FAIL - 추가 검토 필요]

=== 강한 반박(레드팀) ===
- 이 전략이 "우연히" 좋아보일 수 있는 이유 3가지:
  1) [예: OOS 기간이 특정 레짐에 편향]
  2) [예: 파라미터 최적화 과정에서 데이터 스누핑]
  3) [예: 거래 수 부족으로 통계적 유의성 미달]
- 실전에서 깨질 가능성이 큰 지점 3가지:
  1) [예: 슬리피지 과소 추정]
  2) [예: 레짐 전환시 큰 손실 가능]
  3) [예: 용량 제한으로 실제 체결 어려움]

=== 다음 액션 ===
- (PASS면) 실거래 전 점검 체크리스트:
  [ ] 페이퍼 트레이딩 1개월
  [ ] 체결 슬리피지 실측
  [ ] 최대 투자금액/용량 산정
- (FAIL이면) 가장 효과적인 개선/추가 실험 3개:
  1) [구체적 액션]
  2) [구체적 액션]
  3) [구체적 액션]
```

---

## 4. 추가 검증 (선택)

### 6) 시장 레짐별 성과
- 상승장 (B&H > 20%): 알파 [X.X]%, 승률 [XX]%
- 하락장 (B&H < -10%): 알파 [X.X]%, 승률 [XX]%
- 횡보장 (|B&H| < 10%): 알파 [X.X]%, 승률 [XX]%

### 7) 거래 통계
- 총 거래 수: [N]회
- 승률: [XX]%
- 평균 이익: [X.X]%
- 평균 손실: [X.X]%
- 손익비: [X.X]
- 평균 보유 기간: [N]일
- 연환산 Turnover: [X.X]

### 8) 월수익 분포
- 평균: [X.X]%
- 표준편차: [X.X]%
- 왜도: [X.X] (음수면 왼쪽 꼬리)
- 첨도: [X.X] (3 초과면 fat tail)
- 최악 1%: [X.X]%

### 9) 과최적화(데이터 스누핑) 검증
- 전략 탐색 과정에서 시도한 후보 수: [N]개
- 파라미터 수 / 데이터 포인트 수 비율: [X.X]%
- 보정 관점: [다중검정 보정 적용 여부, 방법]
```

---

## 빠른 검증 프롬프트 (간소화 버전)

```
아래 전략을 Walk-Forward 검증하세요.

전략: [전략 설명]
데이터: [데이터 경로]

검증 방법:
1. 2년 IS -> 1년 OOS 롤링 테스트 (2017-2025)
2. 거래비용: 편도 0.25% (수수료+슬리피지)
3. 시그널 1일 지연 (익일 시가 실행)
4. 비용 민감도: 0.5x / 1.0x / 1.5x

통과 기준:
- OOS 알파 평균 > 0
- OOS 알파 양수 비율 > 50%
- OOS CAGR(비용 후) > 4.5%
- OOS 거래 수 >= 30
- 최악 연도 OOS 알파 > -15%

연도별 IS/OOS 알파 테이블 + 강한 반박 3개 + 최종 판정을 제시하세요.
```

---

## 참고: 기존 검증 코드 템플릿

| 파일 | 용도 |
|------|------|
| kosdaq_etf_200ma_validation.py | Walk-Forward 검증 구현 |
| kosdaq_etf_simple_robust.py | 파라미터 강건성 검증 |
| kosdaq_final_strategy_search.py | IS/OOS 일관성 검증 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0 | 2026-01-30 | 초안 작성 |
| v2.0 | 2026-01-30 | 엄격 버전 - 표본 충분성, 비용 민감도, DD Duration, 레드팀 반박 추가 |

---

*작성일: 2026-01-30*
