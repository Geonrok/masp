# Phase 2A 착수 체크리스트

**Protocol**: MASP-v1.0  
**Phase**: 2A - Real Market Data (읽기 전용)  
**Date**: 2026-01-10

---

## 개발 전 (Pre-Development)

### 환경 준비
- [ ] Upbit API 문서 검토 완료 ([https://docs.upbit.com](https://docs.upbit.com))
- [ ] Binance API 문서 검토 완료 ([https://binance-docs.github.io/apidocs/futures](https://binance-docs.github.io/apidocs/futures))
- [ ] API 키 발급 (Upbit Access Key + Secret Key)
- [ ] .env 파일 설정
  ```
  UPBIT_ACCESS_KEY=your_key_here
  UPBIT_SECRET_KEY=your_secret_here
  BINANCE_API_KEY=your_key_here
  BINANCE_API_SECRET=your_secret_here
  ```
- [ ] 의존성 설치
  ```cmd
  scripts\run_in_venv.cmd pip install requests>=2.31.0
  ```

### 테스트 환경
- [ ] 네트워크 연결 확인
- [ ] Rate Limit 정책 숙지 (Upbit: 10/s, Binance: 5/s)
- [ ] 로컬 개발 환경 설정 완료

---

## 개발 중 (During Development)

### Upbit Adapter 구현
- [ ] `UpbitSpotMarketData` 클래스 생성
- [ ] `get_quote(symbol)` 메서드 구현
- [ ] `get_quotes(symbols)` 메서드 구현
- [ ] `is_market_open()` 메서드 구현 (항상 True)
- [ ] Rate Limit 준수 로직 추가
- [ ] 에러 핸들링 (Timeout, 429, 500)
- [ ] API 키 로그 노출 방지 확인

### Binance Adapter 구현
- [ ] `BinanceFuturesMarketData` 클래스 생성
- [ ] `get_quote(symbol)` 메서드 구현
- [ ] `get_quotes(symbols)` 메서드 구현
- [ ] `is_market_open()` 메서드 구현 (항상 True)
- [ ] Futures 심볼 형식 처리 (BTC/USDT:PERP)

### 주문 실행 금지 확인
- [ ] `place_order()` 호출 시 RuntimeError 발생
- [ ] 모든 Execution 메서드에서 NotImplementedError

---

## 개발 후 (Post-Development)

### 기능 검증
- [ ] Upbit `get_quote("BTC/KRW")` 실제 시세 반환
  ```cmd
  scripts\run_in_venv.cmd python -c "from libs.adapters.real_upbit_spot import UpbitSpotMarketData; a = UpbitSpotMarketData(); print(a.get_quote('BTC/KRW'))"
  ```
- [ ] Binance `get_quote("BTC/USDT:PERP")` 실제 시세 반환
  ```cmd
  scripts\run_in_venv.cmd python -c "from libs.adapters.real_binance_futures import BinanceFuturesMarketData; a = BinanceFuturesMarketData(); print(a.get_quote('BTC/USDT:PERP'))"
  ```
- [ ] MarketQuote 객체 형식 준수 확인
  ```python
  assert hasattr(quote, 'symbol')
  assert hasattr(quote, 'bid')
  assert hasattr(quote, 'ask')
  assert hasattr(quote, 'last')
  ```

### 보안 검증
- [ ] Rate Limit 준수 (429 에러 0건)
  - 10초간 100회 호출 테스트 (Upbit)
  - Rate Limit 도달 시 Retry-After 준수
- [ ] API 키 로그 노출 방지 확인
  - 예외 메시지에 키 미포함
  - 일반 로그에 키 미포함
- [ ] `place_order()` 호출 시 RuntimeError 발생
  ```cmd
  scripts\run_in_venv.cmd python -c "from libs.adapters.real_upbit_spot import UpbitSpotExecution; a = UpbitSpotExecution(); a.place_order('BTC/KRW', 'BUY', 0.001)"
  ```
  **기대**: RuntimeError 발생

### CI 통합
- [ ] ci_local.cmd EXIT=0
  ```cmd
  scripts\ci_local.cmd
  echo EXIT=%ERRORLEVEL%
  ```
- [ ] 기존 테스트 회귀 없음

---

## 완료 기준 (Acceptance Criteria)

| # | 항목 | 상태 |
|---|------|------|
| 1 | Upbit `get_quote("BTC/KRW")` 실제 시세 반환 | ⬜ |
| 2 | Binance `get_quote("BTC/USDT:PERP")` 실제 시세 반환 | ⬜ |
| 3 | MarketQuote 객체 형식 준수 | ⬜ |
| 4 | Rate Limit 준수 (429 에러 없음) | ⬜ |
| 5 | API 키 노출 방지 (로그/예외 메시지) | ⬜ |
| 6 | **주문 실행 불가 확인** (place_order 호출 시 RuntimeError) | ⬜ |

**모든 항목 ✅ 시 Phase 2A 완료**

---

## 문제 해결 (Troubleshooting)

### Rate Limit 초과 (429 에러)
**증상**: `429 Too Many Requests` 응답
**해결**:
- Retry-After 헤더 값만큼 대기
- 요청 주기를 늘림 (Upbit: 100ms → 200ms)
- 캐싱 메커니즘 도입

### API 키 인증 실패 (401 에러)
**증상**: `401 Unauthorized` 응답
**해결**:
- .env 파일 API 키 재확인
- 키 발급 시간 확인 (발급 후 1분 대기)
- Upbit: JWT 서명 로직 검증

### 네트워크 타임아웃
**증상**: `requests.exceptions.Timeout`
**해결**:
- Timeout 값 증가 (3초 → 10초)
- 재시도 로직 추가 (최대 3회)
- DNS 확인 (`nslookup api.upbit.com`)

---

**Updated**: 2026-01-10  
**Status**: Phase 2A CHECKLIST READY  
**Next**: Start Upbit MarketData Implementation

---

_Generated by Multi-Asset Strategy Platform Phase 2A Preparation_  
_Protocol: MASP-v1.0_
